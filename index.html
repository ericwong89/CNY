<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²æˆšå…³ç³»è®¡ç®—å™¨ - è¿‡å¹´å¿…å¤‡ç¥å™¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=Noto+Sans+SC:wght@700;900&family=Ma+Shan+Zheng&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #EB3935 0%, #F76B5B 30%, #FF9B64 70%, #E87B5C 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
        }

        /* æ–°å¹´è£…é¥°èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 155, 100, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(247, 107, 91, 0.12) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 420px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        /* é¡¶éƒ¨è£…é¥° */
        .header {
            text-align: center;
            margin-bottom: 15px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 28px;
            font-weight: 900;
            color: #FFFFFF;
            text-shadow: 
                2px 2px 0 #EB3935,
                4px 4px 8px rgba(235, 57, 53, 0.4);
            letter-spacing: 3px;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 13px;
            color: #FFFFFF;
            opacity: 0.95;
        }

        /* è®¡ç®—å™¨ä¸»ä½“ */
        .calculator {
            background: linear-gradient(145deg, #FFFFFF 0%, #FFE8E5 100%);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 
                0 20px 60px rgba(235, 57, 53, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 3px solid #F76B5B;
            animation: popIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* æ˜¾ç¤ºå± */
        .display {
            background: linear-gradient(to bottom, #2C3E50 0%, #1a252f 100%);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            min-height: 100px;
            display: flex;
            gap: 10px;
            box-shadow: 
                inset 0 4px 8px rgba(0, 0, 0, 0.5),
                0 2px 0 rgba(255, 255, 255, 0.1);
            border: 2px solid #34495E;
        }

        .display-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #34495E;
            padding-right: 10px;
        }

        .display-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 10px;
        }

        .input-chain {
            color: #5DADE2;
            font-size: 11px;
            line-height: 1.4;
            font-family: 'Noto Sans SC', sans-serif;
            word-break: break-all;
            opacity: 0.85;
            flex: 1;
            display: flex;
            align-items: center;
        }

        .input-chain.empty {
            color: #7F8C8D;
            font-size: 11px;
        }

        .result {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .result-title {
            color: #FF9B64;
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 5px;
            text-shadow: 
                0 0 15px rgba(255, 155, 100, 0.6),
                0 2px 4px rgba(0, 0, 0, 0.4);
            animation: glow 2s ease-in-out infinite;
            letter-spacing: 2px;
            line-height: 1.2;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 15px rgba(255, 155, 100, 0.6), 0 2px 4px rgba(0, 0, 0, 0.4); }
            50% { text-shadow: 0 0 25px rgba(255, 155, 100, 0.9), 0 2px 8px rgba(0, 0, 0, 0.5); }
        }

        .result-desc {
            color: #BDC3C7;
            font-size: 10px;
            line-height: 1.3;
        }

        /* æŒ‰é’®ç½‘æ ¼ */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .btn {
            background: linear-gradient(145deg, #F76B5B, #EB3935);
            color: #FFF;
            border: none;
            border-radius: 10px;
            padding: 12px 8px;
            font-size: 14px;
            font-weight: 700;
            font-family: 'Noto Sans SC', sans-serif;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 
                0 3px 0 #D93531,
                0 6px 12px rgba(235, 57, 53, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(3px);
            box-shadow: 
                0 0px 0 #D93531,
                0 3px 6px rgba(235, 57, 53, 0.3);
        }

        .btn.relation {
            background: linear-gradient(145deg, #F76B5B, #EB3935);
        }

        /* ä½¿ç”¨ä¸åŒé¢œè‰²ä¸ºä¸åŒç±»å‹çš„æŒ‰é’® */
        .btn:nth-child(3n+1) {
            background: linear-gradient(145deg, #EB3935, #D93531);
        }

        .btn:nth-child(3n+2) {
            background: linear-gradient(145deg, #F76B5B, #EB3935);
        }

        .btn:nth-child(3n) {
            background: linear-gradient(145deg, #FF9B64, #F76B5B);
        }

        /* æ€§åˆ«é€‰æ‹©å¼€å…³ */
        .gender-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 12px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            border: 1px solid rgba(247, 107, 91, 0.3);
        }

        .gender-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .gender-label {
            color: #EB3935;
            font-size: 11px;
            font-weight: 700;
        }

        .gender-toggle {
            display: flex;
            background: rgba(235, 57, 53, 0.15);
            border-radius: 15px;
            padding: 2px;
            box-shadow: inset 0 2px 4px rgba(235, 57, 53, 0.1);
        }

        .gender-btn {
            padding: 4px 14px;
            border: none;
            border-radius: 13px;
            font-size: 11px;
            font-weight: 700;
            font-family: 'Noto Sans SC', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #999;
        }

        .gender-btn.active {
            background: linear-gradient(145deg, #3498DB, #2980B9);
            color: #FFF;
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.4);
        }

        .gender-btn:first-child.active {
            background: linear-gradient(145deg, #3498DB, #2980B9);
        }

        .gender-btn:last-child.active {
            background: linear-gradient(145deg, #F76B5B, #EB3935);
        }

        /* å°å‹æ§åˆ¶æŒ‰é’® */
        .control-buttons-small {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            background: linear-gradient(145deg, #FF9B64, #F76B5B);
            color: #FFF;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 700;
            font-family: 'Noto Sans SC', sans-serif;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 
                0 3px 0 #E87B5C,
                0 5px 10px rgba(232, 123, 92, 0.3);
        }

        .btn-small:active {
            transform: translateY(3px);
            box-shadow: 
                0 0px 0 #E87B5C,
                0 2px 5px rgba(232, 123, 92, 0.3);
        }

        .btn-small.backspace {
            background: linear-gradient(145deg, #E87B5C, #F76B5B);
            box-shadow: 0 3px 0 #D96B4C, 0 5px 10px rgba(232, 123, 92, 0.3);
        }

        /* æç¤ºä¿¡æ¯ */
        .tips {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 12px;
            margin-top: 12px;
            border: 2px solid #F76B5B;
            box-shadow: 0 4px 15px rgba(247, 107, 91, 0.2);
        }

        .tips-title {
            color: #EB3935;
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tips-content {
            color: #555;
            font-size: 11px;
            line-height: 1.5;
        }

        .tips-content p {
            margin-bottom: 4px;
        }

        .example {
            background: #FFE8E5;
            padding: 6px 10px;
            border-radius: 6px;
            margin-top: 6px;
            border-left: 3px solid #F76B5B;
            font-size: 11px;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 380px) {
            .btn {
                padding: 10px 6px;
                font-size: 13px;
            }
            
            h1 {
                font-size: 24px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            color: #3498DB;
            font-size: 12px;
            padding: 0;
        }

        .loading.show {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        /* æ–°å¹´ç¥ç¦è£…é¥° */
        .blessing {
            text-align: center;
            margin-top: 10px;
            font-family: 'Ma Shan Zheng', cursive;
            color: #FFFFFF;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(235, 57, 53, 0.3);
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>äº²æˆšå…³ç³»è®¡ç®—å™¨</h1>
            <p class="subtitle">è¿‡å¹´å¿…å¤‡Â·ä¸€é”®æå®šç§°è°“</p>
        </div>

        <div class="calculator">
            <!-- æ˜¾ç¤ºå± -->
            <div class="display">
                <!-- å·¦ä¾§:å…³ç³»é“¾ -->
                <div class="display-left">
                    <div class="input-chain empty" id="inputChain">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹</div>
                </div>
                
                <!-- å³ä¾§:ç§°è°“ç»“æœ -->
                <div class="display-right">
                    <div class="result" id="result" style="display: none;">
                        <div class="result-title" id="resultTitle"></div>
                        <div class="result-desc" id="resultDesc"></div>
                    </div>
                    <div class="loading" id="loading">è®¡ç®—ä¸­...</div>
                </div>
            </div>

            <!-- æ€§åˆ«é€‰æ‹© + æ§åˆ¶æŒ‰é’® -->
            <div class="gender-switch">
                <div class="gender-group">
                    <span class="gender-label">æˆ‘æ˜¯:</span>
                    <div class="gender-toggle">
                        <button class="gender-btn active" id="btnMale" onclick="selectGender('male')">ç”· â™‚</button>
                        <button class="gender-btn" id="btnFemale" onclick="selectGender('female')">å¥³ â™€</button>
                    </div>
                </div>
                <div class="control-buttons-small">
                    <button class="btn-small" onclick="clearAll()">æ¸…ç©º âœ•</button>
                    <button class="btn-small backspace" onclick="backspace()">é€€æ ¼ âŒ«</button>
                </div>
            </div>

            <!-- å…³ç³»æŒ‰é’® -->
            <div class="button-grid">
                <button class="btn relation" onclick="addRelation('f', 'çˆ¸çˆ¸')">çˆ¸çˆ¸</button>
                <button class="btn relation" onclick="addRelation('m', 'å¦ˆå¦ˆ')">å¦ˆå¦ˆ</button>
                <button class="btn relation" onclick="addRelation('h', 'ä¸ˆå¤«')">ä¸ˆå¤«</button>
                
                <button class="btn relation" onclick="addRelation('w', 'å¦»å­')">å¦»å­</button>
                <button class="btn relation" onclick="addRelation('s', 'å„¿å­')">å„¿å­</button>
                <button class="btn relation" onclick="addRelation('d', 'å¥³å„¿')">å¥³å„¿</button>
                
                <button class="btn relation" onclick="addRelation('ob', 'å“¥å“¥')">å“¥å“¥</button>
                <button class="btn relation" onclick="addRelation('lb', 'å¼Ÿå¼Ÿ')">å¼Ÿå¼Ÿ</button>
                <button class="btn relation" onclick="addRelation('os', 'å§å§')">å§å§</button>
                
                <button class="btn relation" onclick="addRelation('ls', 'å¦¹å¦¹')">å¦¹å¦¹</button>
                <button class="btn relation" onclick="addRelation('xb', 'å…„å¼Ÿ')">å…„å¼Ÿ</button>
                <button class="btn relation" onclick="addRelation('xs', 'å§å¦¹')">å§å¦¹</button>
            </div>
        </div>

        <!-- ä½¿ç”¨æç¤º -->
        <div class="tips">
            <div class="tips-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜</div>
            <div class="tips-content">
                <p><strong>1.</strong> å…ˆé€‰æ‹©"æˆ‘æ˜¯"ç”·æˆ–å¥³</p>
                <p><strong>2.</strong> ä¾æ¬¡ç‚¹å‡»æŒ‰é’®æè¿°å…³ç³»,å¦‚:"çˆ¸çˆ¸" â†’ "å“¥å“¥" = ä¼¯ä¼¯</p>
                <p><strong>3.</strong> ç‚¹å‡»"é€€æ ¼"å¯ä»¥æ’¤é”€ä¸Šä¸€æ­¥,"æ¸…ç©º"é‡æ–°å¼€å§‹</p>
                <div class="example">
                    <strong>ç¤ºä¾‹:</strong> å¦ˆå¦ˆ â†’ å¦ˆå¦ˆ â†’ å“¥å“¥ = èˆ…å§¥çˆ·
                </div>
            </div>
        </div>

        <div class="blessing">
            ğŸ§§ æ–°æ˜¥å¿«ä¹ Â· é˜–å®¶æ¬¢ä¹ ğŸ§§
        </div>
    </div>

    <!-- relationship.js æ ¸å¿ƒç®—æ³• -->
    <script src="https://cdn.jsdelivr.net/npm/relationship.js@latest/dist/relationship.min.js"></script>
    
    <script>
        let relationChain = [];
        let displayChain = [];
        let userGender = 'male'; // é»˜è®¤ç”·æ€§

        // æ·»åŠ å…³ç³»
        function addRelation(code, name) {
            relationChain.push(code);
            displayChain.push(name);
            updateDisplay();
            calculateRelation();
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const chainEl = document.getElementById('inputChain');
            if (displayChain.length === 0) {
                chainEl.textContent = 'è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹';
                chainEl.classList.add('empty');
            } else {
                chainEl.textContent = 'æˆ‘çš„ ' + displayChain.join(' çš„ ');
                chainEl.classList.remove('empty');
            }
            console.log('å½“å‰å…³ç³»é“¾:', relationChain.join(','));
            console.log('æ˜¾ç¤ºæ–‡æœ¬:', displayChain.join(' çš„ '));
            console.log('ç”¨æˆ·æ€§åˆ«:', userGender);
        }

        // æ€§åˆ«é€‰æ‹©
        function selectGender(gender) {
            userGender = gender;
            const maleBtn = document.getElementById('btnMale');
            const femaleBtn = document.getElementById('btnFemale');
            
            if (gender === 'male') {
                maleBtn.classList.add('active');
                femaleBtn.classList.remove('active');
            } else {
                femaleBtn.classList.add('active');
                maleBtn.classList.remove('active');
            }
            
            // å¦‚æœå·²æœ‰å…³ç³»é“¾,é‡æ–°è®¡ç®—
            if (relationChain.length > 0) {
                calculateRelation();
            }
        }

        // è®¡ç®—å…³ç³»
        function calculateRelation() {
            const resultEl = document.getElementById('result');
            const titleEl = document.getElementById('resultTitle');
            const descEl = document.getElementById('resultDesc');
            const loadingEl = document.getElementById('loading');

            if (relationChain.length === 0) {
                resultEl.style.display = 'none';
                return;
            }

            // æ˜¾ç¤ºåŠ è½½
            loadingEl.classList.add('show');
            resultEl.style.display = 'none';

            setTimeout(() => {
                let result = null;
                
                // ç›´æ¥ä½¿ç”¨ç®€åŒ–ç®—æ³•(å› ä¸ºrelationship.jså¯èƒ½åŠ è½½å¤±è´¥)
                result = calculateSimple(relationChain);
                
                loadingEl.classList.remove('show');
                
                if (result && result !== 'æ— ' && result !== null) {
                    titleEl.textContent = result;
                    descEl.textContent = getDescription(result);
                    resultEl.style.display = 'block';
                } else {
                    titleEl.textContent = 'å…³ç³»è¾ƒè¿œ';
                    descEl.textContent = 'è¿™ä¸ªå…³ç³»ç§°è°“æ¯”è¾ƒå¤æ‚å“¦ ğŸ¤”';
                    resultEl.style.display = 'block';
                }
            }, 150);
        }

        // ç®€åŒ–ç®—æ³•(ä¸»è¦ç®—æ³•)
        function calculateSimple(chain) {
            if (!chain || chain.length === 0) return null;
            
            // å®Œæ•´çš„æ˜ å°„è¡¨
            const mapping = {
                // å•å±‚å…³ç³»
                'f': 'çˆ¸çˆ¸',
                'm': 'å¦ˆå¦ˆ',
                'h': 'ä¸ˆå¤«',
                'w': 'å¦»å­',
                's': 'å„¿å­',
                'd': 'å¥³å„¿',
                'ob': 'å“¥å“¥',
                'lb': 'å¼Ÿå¼Ÿ',
                'os': 'å§å§',
                'ls': 'å¦¹å¦¹',
                
                // ç¥–è¾ˆ
                'f,f': 'çˆ·çˆ·',
                'f,m': 'å¥¶å¥¶',
                'm,f': 'å¤–å…¬',
                'm,m': 'å¤–å©†',
                
                // æ›¾ç¥–è¾ˆ
                'f,f,f': 'å¤ªçˆ·çˆ·',
                'f,f,m': 'å¤ªå¥¶å¥¶',
                'f,m,f': 'å¤ªå¤–å…¬',
                'f,m,m': 'å¤ªå¤–å©†',
                'm,f,f': 'å¤ªå¤–å…¬',
                'm,f,m': 'å¤ªå¤–å©†',
                'm,m,f': 'å¤ªå§¥çˆ·',
                'm,m,m': 'å¤ªå§¥å§¥',
                
                // çˆ¶ç³»æ—ç³»é•¿è¾ˆ
                'f,ob': 'ä¼¯ä¼¯',
                'f,lb': 'å”å”',
                'f,os': 'å§‘å§‘',
                'f,ls': 'å§‘å§‘',
                'f,xb': 'ä¼¯ä¼¯/å”å”',
                'f,xs': 'å§‘å§‘',
                
                // çˆ¶ç³»æ—ç³»é•¿è¾ˆçš„é…å¶
                'f,ob,w': 'ä¼¯æ¯',
                'f,lb,w': 'å©¶å©¶',
                'f,os,h': 'å§‘çˆ¶',
                'f,ls,h': 'å§‘çˆ¶',
                
                // æ¯ç³»æ—ç³»é•¿è¾ˆ
                'm,ob': 'èˆ…èˆ…',
                'm,lb': 'èˆ…èˆ…',
                'm,os': 'å§¨å¦ˆ',
                'm,ls': 'å§¨å¦ˆ',
                'm,xb': 'èˆ…èˆ…',
                'm,xs': 'å§¨å¦ˆ',
                
                // æ¯ç³»æ—ç³»é•¿è¾ˆçš„é…å¶
                'm,ob,w': 'èˆ…å¦ˆ',
                'm,lb,w': 'èˆ…å¦ˆ',
                'm,os,h': 'å§¨çˆ¶',
                'm,ls,h': 'å§¨çˆ¶',
                
                // æ›´è¿œçš„é•¿è¾ˆ
                'f,f,ob': 'ä¼¯çˆ·çˆ·',
                'f,f,lb': 'å”çˆ·çˆ·',
                'f,f,os': 'å§‘å¥¶å¥¶',
                'f,f,ls': 'å§‘å¥¶å¥¶',
                'm,f,ob': 'èˆ…å§¥çˆ·',
                'm,f,lb': 'èˆ…å§¥çˆ·',
                'm,m,ob': 'èˆ…å§¥çˆ·',
                'm,m,lb': 'èˆ…å§¥çˆ·',
                'm,m,os': 'å§¨å§¥å§¥',
                'm,m,ls': 'å§¨å§¥å§¥',
                
                // å ‚è¡¨å…„å¼Ÿå§å¦¹
                'f,ob,s': 'å ‚å“¥/å ‚å¼Ÿ',
                'f,ob,d': 'å ‚å§/å ‚å¦¹',
                'f,lb,s': 'å ‚å“¥/å ‚å¼Ÿ',
                'f,lb,d': 'å ‚å§/å ‚å¦¹',
                'f,os,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'f,os,d': 'è¡¨å§/è¡¨å¦¹',
                'f,ls,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'f,ls,d': 'è¡¨å§/è¡¨å¦¹',
                'm,ob,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'm,ob,d': 'è¡¨å§/è¡¨å¦¹',
                'm,lb,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'm,lb,d': 'è¡¨å§/è¡¨å¦¹',
                'm,os,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'm,os,d': 'è¡¨å§/è¡¨å¦¹',
                'm,ls,s': 'è¡¨å“¥/è¡¨å¼Ÿ',
                'm,ls,d': 'è¡¨å§/è¡¨å¦¹',
                
                // é…å¶çš„çˆ¶æ¯
                'h,f': 'å…¬å…¬',
                'h,m': 'å©†å©†',
                'w,f': 'å²³çˆ¶',
                'w,m': 'å²³æ¯',
                
                // é…å¶çš„å…„å¼Ÿå§å¦¹
                'h,ob': 'å¤§ä¼¯å­',
                'h,lb': 'å°å”å­',
                'h,os': 'å¤§å§‘å­',
                'h,ls': 'å°å§‘å­',
                'w,ob': 'å¤§èˆ…å­',
                'w,lb': 'å°èˆ…å­',
                'w,os': 'å¤§å§¨å­',
                'w,ls': 'å°å§¨å­',
                
                // å­™è¾ˆ
                's,s': 'å­™å­',
                's,d': 'å­™å¥³',
                'd,s': 'å¤–å­™',
                'd,d': 'å¤–å­™å¥³',
                
                // æ›¾å­™è¾ˆ
                's,s,s': 'æ›¾å­™',
                's,s,d': 'æ›¾å­™å¥³',
                's,d,s': 'æ›¾å­™',
                's,d,d': 'æ›¾å­™å¥³',
                'd,s,s': 'æ›¾å¤–å­™',
                'd,s,d': 'æ›¾å¤–å­™å¥³',
                'd,d,s': 'æ›¾å¤–å­™',
                'd,d,d': 'æ›¾å¤–å­™å¥³',
                
                // ä¾„è¾ˆ
                'ob,s': 'ä¾„å­',
                'ob,d': 'ä¾„å¥³',
                'lb,s': 'ä¾„å­',
                'lb,d': 'ä¾„å¥³',
                'xb,s': 'ä¾„å­',
                'xb,d': 'ä¾„å¥³',
                
                // ç”¥è¾ˆ
                'os,s': 'å¤–ç”¥',
                'os,d': 'å¤–ç”¥å¥³',
                'ls,s': 'å¤–ç”¥',
                'ls,d': 'å¤–ç”¥å¥³',
                'xs,s': 'å¤–ç”¥',
                'xs,d': 'å¤–ç”¥å¥³',
                
                // å…„å¼Ÿå§å¦¹çš„é…å¶
                'ob,w': 'å«‚å­',
                'lb,w': 'å¼Ÿåª³',
                'os,h': 'å§å¤«',
                'ls,h': 'å¦¹å¤«',
                
                // å­å¥³çš„é…å¶
                's,w': 'å„¿åª³',
                'd,h': 'å¥³å©¿'
            };

            const key = chain.join(',');
            console.log('æŸ¥æ‰¾å…³ç³»é”®:', key); // è°ƒè¯•ç”¨
            
            let result = mapping[key];
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°,å°è¯•å¤„ç†xb/xsçš„æƒ…å†µ
            if (!result && (key.includes('xb') || key.includes('xs'))) {
                // xbå¯èƒ½æ˜¯obæˆ–lb
                let testKey = key.replace('xb', 'ob');
                result = mapping[testKey];
                if (!result) {
                    testKey = key.replace('xb', 'lb');
                    result = mapping[testKey];
                }
                // xså¯èƒ½æ˜¯osæˆ–ls
                if (!result) {
                    testKey = key.replace('xs', 'os');
                    result = mapping[testKey];
                }
                if (!result) {
                    testKey = key.replace('xs', 'ls');
                    result = mapping[testKey];
                }
            }
            
            console.log('è®¡ç®—ç»“æœ:', result); // è°ƒè¯•ç”¨
            return result;
        }

        // è·å–æè¿°
        function getDescription(title) {
            if (!title) return 'å…³ç³»ç§°è°“';
            
            const descriptions = {
                'çˆ¸çˆ¸': 'çˆ¶äº²,å®¶åº­çš„é¡¶æ¢æŸ±',
                'å¦ˆå¦ˆ': 'æ¯äº²,æœ€æ¸©æš–çš„æ¸¯æ¹¾',
                'çˆ·çˆ·': 'çˆ¶äº²çš„çˆ¶äº²,è®°å¾—ç»™çˆ·çˆ·æ‹œå¹´å“¦!',
                'å¥¶å¥¶': 'çˆ¶äº²çš„æ¯äº²,åˆ«å¿˜äº†å‘å¥¶å¥¶é—®å¥½!',
                'å¤–å…¬': 'æ¯äº²çš„çˆ¶äº²,æ‚¨çš„å¤–ç¥–çˆ¶',
                'å¤–å©†': 'æ¯äº²çš„æ¯äº²,æ‚¨çš„å¤–ç¥–æ¯',
                'å¤ªçˆ·çˆ·': 'çˆ·çˆ·çš„çˆ¶äº²,æ›¾ç¥–çˆ¶',
                'å¤ªå¥¶å¥¶': 'çˆ·çˆ·çš„æ¯äº²,æ›¾ç¥–æ¯',
                'å¤ªå¤–å…¬': 'å¤–å…¬çš„çˆ¶äº²,æ›¾å¤–ç¥–çˆ¶',
                'å¤ªå¤–å©†': 'å¤–å©†çš„æ¯äº²,æ›¾å¤–ç¥–æ¯',
                'å¤ªå§¥çˆ·': 'å¤–å…¬çš„çˆ¶äº²,æ›¾å¤–ç¥–çˆ¶',
                'å¤ªå§¥å§¥': 'å¤–å©†çš„æ¯äº²,æ›¾å¤–ç¥–æ¯',
                'ä¼¯ä¼¯': 'çˆ¶äº²çš„å“¥å“¥,åº”è¯¥å«ä¼¯ä¼¯',
                'ä¼¯ä¼¯/å”å”': 'çˆ¶äº²çš„å…„å¼Ÿ',
                'å”å”': 'çˆ¶äº²çš„å¼Ÿå¼Ÿ,åº”è¯¥å«å”å”',
                'å§‘å§‘': 'çˆ¶äº²çš„å§å¦¹,åº”è¯¥å«å§‘å§‘',
                'èˆ…èˆ…': 'æ¯äº²çš„å…„å¼Ÿ,åº”è¯¥å«èˆ…èˆ…',
                'å§¨å¦ˆ': 'æ¯äº²çš„å§å¦¹,åº”è¯¥å«å§¨å¦ˆ',
                'ä¼¯æ¯': 'ä¼¯ä¼¯çš„å¦»å­',
                'å©¶å©¶': 'å”å”çš„å¦»å­',
                'å§‘çˆ¶': 'å§‘å§‘çš„ä¸ˆå¤«',
                'èˆ…å¦ˆ': 'èˆ…èˆ…çš„å¦»å­',
                'å§¨çˆ¶': 'å§¨å¦ˆçš„ä¸ˆå¤«',
                'ä¼¯çˆ·çˆ·': 'çˆ·çˆ·çš„å“¥å“¥',
                'å”çˆ·çˆ·': 'çˆ·çˆ·çš„å¼Ÿå¼Ÿ',
                'å§‘å¥¶å¥¶': 'çˆ·çˆ·çš„å§å¦¹',
                'èˆ…å§¥çˆ·': 'å¤–å©†/å¤–å…¬çš„å…„å¼Ÿ',
                'å§¨å§¥å§¥': 'å¤–å©†çš„å§å¦¹',
                'å…¬å…¬': 'ä¸ˆå¤«çš„çˆ¶äº²',
                'å©†å©†': 'ä¸ˆå¤«çš„æ¯äº²',
                'å²³çˆ¶': 'å¦»å­çš„çˆ¶äº²',
                'å²³æ¯': 'å¦»å­çš„æ¯äº²',
                'å¤§ä¼¯å­': 'ä¸ˆå¤«çš„å“¥å“¥',
                'å°å”å­': 'ä¸ˆå¤«çš„å¼Ÿå¼Ÿ',
                'å¤§å§‘å­': 'ä¸ˆå¤«çš„å§å§',
                'å°å§‘å­': 'ä¸ˆå¤«çš„å¦¹å¦¹',
                'å¤§èˆ…å­': 'å¦»å­çš„å“¥å“¥',
                'å°èˆ…å­': 'å¦»å­çš„å¼Ÿå¼Ÿ',
                'å¤§å§¨å­': 'å¦»å­çš„å§å§',
                'å°å§¨å­': 'å¦»å­çš„å¦¹å¦¹',
                'å„¿å­': 'æ‚¨çš„å„¿å­',
                'å¥³å„¿': 'æ‚¨çš„å¥³å„¿',
                'å­™å­': 'å„¿å­çš„å„¿å­',
                'å­™å¥³': 'å„¿å­çš„å¥³å„¿',
                'å¤–å­™': 'å¥³å„¿çš„å„¿å­',
                'å¤–å­™å¥³': 'å¥³å„¿çš„å¥³å„¿',
                'æ›¾å­™': 'å­™å­çš„å„¿å­',
                'æ›¾å­™å¥³': 'å­™å­çš„å¥³å„¿',
                'æ›¾å¤–å­™': 'å¤–å­™çš„å„¿å­',
                'æ›¾å¤–å­™å¥³': 'å¤–å­™çš„å¥³å„¿',
                'ä¾„å­': 'å…„å¼Ÿçš„å„¿å­',
                'ä¾„å¥³': 'å…„å¼Ÿçš„å¥³å„¿',
                'å¤–ç”¥': 'å§å¦¹çš„å„¿å­',
                'å¤–ç”¥å¥³': 'å§å¦¹çš„å¥³å„¿',
                'å“¥å“¥': 'æ¯”æ‚¨å¹´é•¿çš„å…„å¼Ÿ',
                'å¼Ÿå¼Ÿ': 'æ¯”æ‚¨å¹´è½»çš„å…„å¼Ÿ',
                'å§å§': 'æ¯”æ‚¨å¹´é•¿çš„å§å¦¹',
                'å¦¹å¦¹': 'æ¯”æ‚¨å¹´è½»çš„å§å¦¹',
                'å«‚å­': 'å“¥å“¥çš„å¦»å­',
                'å¼Ÿåª³': 'å¼Ÿå¼Ÿçš„å¦»å­',
                'å§å¤«': 'å§å§çš„ä¸ˆå¤«',
                'å¦¹å¤«': 'å¦¹å¦¹çš„ä¸ˆå¤«',
                'ä¸ˆå¤«': 'æ‚¨çš„é…å¶',
                'å¦»å­': 'æ‚¨çš„é…å¶',
                'å„¿åª³': 'å„¿å­çš„å¦»å­',
                'å¥³å©¿': 'å¥³å„¿çš„ä¸ˆå¤«'
            };
            
            // å¤„ç†åŒ…å«æ–œæ çš„ç§°è°“(å¦‚"å ‚å“¥/å ‚å¼Ÿ")
            if (title.includes('/')) {
                const parts = title.split('/');
                return `å¯ç§°ä¸º${parts.join('æˆ–')},æ ¹æ®å¹´é¾„åŒºåˆ†`;
            }
            
            return descriptions[title] || 'è¿™æ˜¯æ‚¨çš„äº²æˆšå…³ç³»ç§°è°“';
        }

        // æ¸…ç©º
        function clearAll() {
            relationChain = [];
            displayChain = [];
            updateDisplay();
            document.getElementById('result').style.display = 'none';
        }

        // é€€æ ¼
        function backspace() {
            if (relationChain.length > 0) {
                relationChain.pop();
                displayChain.pop();
                updateDisplay();
                if (relationChain.length === 0) {
                    document.getElementById('result').style.display = 'none';
                } else {
                    calculateRelation();
                }
            }
        }

        // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½
        window.addEventListener('load', function() {
            if (typeof relationship === 'undefined') {
                console.warn('relationship.js æœªèƒ½åŠ è½½,ä½¿ç”¨ç®€åŒ–ç®—æ³•');
            }
        });
    </script>
</body>
</html>
